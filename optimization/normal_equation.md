好的，我们来详细解释**正规方程（Normal Equation）**：  $A^T A x = A^T b$ 。

这是求解**线性**最小二乘问题的核心公式。

---

### **1. 问题起源：我们想解决什么？**

我们有一个**超定方程组**（方程数量多于未知数数量）：

$$
A x \approx b
$$

其中：
-  $A$  是一个  $m \times n$  的矩阵（ $m > n$ )，称为**设计矩阵**或**系数矩阵**。
-  $x$  是一个  $n \times 1$  的向量，是我们要求解的**未知参数**。
-  $b$  是一个  $m \times 1$  的向量，是**观测值**或**目标值**。

由于方程组没有精确解（ $b$  不在  $A$  的列空间内），我们的目标是找到一个向量  $x^*$ ，使得**预测值  $A x^*$** 与**真实值  $b$** 之间的差距最小。这个差距用**残差平方和**来衡量：

$$
R(x) = \| A x - b \|_2^2 = (Ax - b)^T (Ax - b) = \sum_{i=1}^m (a_i^T x - b_i)^2
$$

我们的任务就是最小化  $R(x)$ ：

$$
x^* = \arg\min_{x} \| A x - b \|_2^2
$$


---

### **2. 正规方程的推导：如何得到  $A^T A x = A^T b$ ？**

最小化  $R(x)$  是一个无约束的优化问题。我们通过**微积分**和**几何**两种视角来推导。

#### **视角一：微积分（求导并令导数为零）**

1.  **展开目标函数**：

$$
    \begin{aligned}
    R(x) &= (Ax - b)^T (Ax - b) \\
         &= (x^T A^T - b^T)(Ax - b) \\
         &= x^T A^T A x - x^T A^T b - b^T A x + b^T b
    \end{aligned}
    $$

（注意  $x^T A^T b$  是一个标量，所以  $x^T A^T b = b^T A x$ ）

$$
    R(x) = x^T A^T A x - 2 x^T A^T b + b^T b
    $$


2.  **对  $x$  求梯度（Gradient）并令其为零**：
    我们需要用到矩阵微分的两个法则：
    -  $\nabla_x (x^T M x) = 2Mx$  （如果  $M$  是对称矩阵，而  $A^TA$  总是对称的）
    -  $\nabla_x (c^T x) = c$

    因此， $R(x)$  的梯度为：

$$
    \nabla_x R(x) = 2 A^T A x - 2 A^T b
    $$

令梯度为零以找到极小值点：

$$
    \nabla_x R(x) = 0 \implies 2 A^T A x - 2 A^T b = 0
    $$


$$
    \implies A^T A x = A^T b
    $$

这就是**正规方程**。

#### **视角二：几何（正交投影）**

从几何上看，我们要找到的  $A x^*$  是向量  $b$  在  $A$  的**列空间**（Column Space）上的**正交投影**。



-  $A$  的列空间是所有  $A x$  的集合，它是一个  $n$  维的超平面（或子空间）。
- 最小化距离  $\| A x - b \|$  意味着要找到这个子空间上离  $b$  最近的点，这个点就是  $b$  的投影  $p$ 。
- 连接  $b$  和其投影  $p$  的向量是**误差向量  $e = b - A x^*$**。这个误差向量必须**垂直于**$A$  的列空间。

如何表示“垂直”？一个向量垂直于一个子空间，当且仅当它垂直于该子空间的**一组基**。而  $A$  的列向量正好张成了它的列空间。所以，误差向量  $e$  必须与  $A$  的**每一个列向量**都垂直（内积为零）。

这个条件可以简洁地写为：

$$
A^T e = 0
$$

代入  $e = b - A x^*$ ：

$$
A^T (b - A x^*) = 0
$$


$$
\implies A^T b - A^T A x^* = 0
$$


$$
\implies A^T A x^* = A^T b
$$

再次得到了正规方程。

---

### **3. 正规方程的解**

方程  $A^T A x = A^T b$  是一个新的线性方程组。它的解  $x^*$  就是原最小二乘问题的最优解。

- **存在性与唯一性**：如果  $A$  是**列满秩**的（即  $\text{rank}(A) = n$ ，它的列向量线性无关），那么  $A^T A$  是一个  $n \times n$  的**对称正定矩阵**，它是可逆的。此时解是唯一的：

$$
  x^* = (A^T A)^{-1} A^T b
  $$

- **如果  $A$  不是列满秩**：那么  $A^T A$  是奇异的（不可逆），正规方程会有无穷多个解。此时需要其他方法（如SVD）来求一个最小范数解。

---

### **4. 优缺点**

**优点**：
- **理论优美**：提供了一个封闭形式的解析解。
- **直接了当**：对于中小规模问题，直接计算这个公式非常高效。

**缺点**：
- **数值稳定性**：计算  $A^T A$  会放大原始数据  $A$  中的误差（条件数变为  $\text{cond}(A^T A) = [\text{cond}(A)]^2$ ），对于病态矩阵非常不友好。
- **计算成本**：当  $n$ （特征数量）很大时，计算  $A^T A$  ( $O(mn^2)$ ) 和求其逆 ( $O(n^3)$ ) 的成本非常高。

因此，对于大规模或病态问题，通常使用更稳定的算法，如**基于QR分解**或**SVD分解**的方法，而不是直接求解正规方程。

---

### **总结**

正规方程  $A^T A x = A^T b$  是求解线性最小二乘问题的核心。它通过**微积分求极值**或**几何投影**的原理推导而来，其解  $x^*$  使得预测值与观测值之间的残差平方和最小。

它是一个强大而基础的工具，广泛应用于统计学、机器学习、工程学和科学计算的各个领域。
